generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        String     @id @default(uuid())
  email     String     @unique
  password  String
  role      Role       @default(USER)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
}


model Batch {
  id              String     @id @default(uuid())
  batchCode       String     @unique
  batchName     String   @unique

  flightNumber  String?  // Assigned after airline confirmation
  airline       String?

  currentLat    Float?
  currentLng    Float?
  status          BatchStatus @default(PENDING)
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt

  shipments       Shipment[]
}

model Shipment {
  id             String   @id @default(uuid())

  batchId        String
  batch          Batch    @relation(fields: [batchId], references: [id], onDelete: Cascade)

  senderName     String
  senderEmail    String

  receiverName   String
  receiverEmail  String
  receiverPhone  String?
  description    String?

  trackingNumber String?  @unique
  currentStatus  Status   @default(PENDING)

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  statusLogs     StatusLog[]

  @@index([trackingNumber])
  @@index([batchId])
}


model StatusLog {
  id         String   @id @default(uuid())
  shipmentId String
  status     String
  message    String?
  createdAt  DateTime @default(now())
  shipment   Shipment @relation(fields: [shipmentId], references: [id])
}

enum Role {
  ADMIN
  USER
}

 enum Status {
  PENDING
  IN_TRANSIT
  DELIVERED
  FAILED
  RETURNED
}

enum BatchStatus {
  PENDING      // created but no flight yet
  READY        // flight assigned, tracking generated
  IN_TRANSIT
  DELIVERED
}